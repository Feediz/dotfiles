startup_message off
termcapinfo xterm* 'hs:ts=\E]0;:fs=\007:ds=\E]0;screen\007:ti@:te@'
shell -bash
layout autosave on
defscrollback 100000

screen -t rails
select 0
wrap off
stuff "lsof -i tcp:3000 | awk 'NR!=1 {print $2}' | xargs kill ^M"
stuff "cd ~/Handshake/handshake; ^M"
stuff "bundle install; bundle exec rake db:migrate ^M"
stuff "set -a; . .env; set +a ^M"
stuff "bin/conditional_pgbouncer bin/conditional_socksify bin/web ^M"

screen -t worker
select 1
stuff "cd ~/Handshake/handshake; set -a; . .env; set +a; ^M"
stuff "bin/conditional_pgbouncer bundle exec sidekiq -C config/sidekiq_worker.yml ^M"

screen -t urgent
select 2
stuff "cd ~/Handshake/handshake; set -a; . .env; set +a; ^M"
stuff "bin/conditional_pgbouncer bundle exec sidekiq -C config/sidekiq_urgent.yml ^M"

screen -t reindex
select 3
stuff "cd ~/Handshake/handshake; set -a; . .env; set +a; ^M"
stuff "bin/conditional_pgbouncer bundle exec sidekiq -C config/sidekiq_reindex.yml ^M"

screen -t heavy
select 4
stuff "cd ~/Handshake/handshake; set -a; . .env; set +a; ^M"
stuff "bin/conditional_pgbouncer bundle exec sidekiq -C config/sidekiq_heavy.yml ^M"

screen -t clock
select 5
stuff "cd ~/Handshake/handshake; set -a; . .env; set +a; ^M"
stuff "bundle exec clockwork clock.rb ^M"

screen -t reindexer
select 6
stuff "cd ~/Handshake/handshake; set -a; . .env; set +a; ^M"
stuff "bin/conditional_pgbouncer bundle exec ruby reindexer.rb ^M"

screen -t webpack
select 7
stuff "cd ~/Handshake/handshake; set -a; . .env; set +a; ^M"
stuff "bin/webpack ^M"

screen -t guard
select 8
stuff "cd ~/Handshake/handshake; set -a; . .env; set +a; ^M"
stuff "bundle exec guard ^M"

screen -t karma
select 9
stuff "cd ~/Handshake/handshake; nvm use; npm run local-test; ^M"

altscreen on
term screen-256color
bind ',' prev
bind '.' next
bind 'K' quit

# change the hardstatus settings to give an window list at the bottom of the
# screen, with the time and date and with the current window highlighted
hardstatus alwayslastline
hardstatus string '%{= kG}[ %{G}%H %{g}][%= %{= kw}%?%-Lw%?%{r}(%{W}%n*%f%t%?(%u)%?%{r})%{w}%?%+Lw%?%?%= %{g}][%{B} %m-%d %{W}%c %{g}]'
