startup_message off
termcapinfo xterm* 'hs:ts=\E]0;:fs=\007:ds=\E]0;screen\007:ti@:te@'
shell -bash
layout autosave on
defscrollback 100000

screen -t rails
select 0
wrap off
stuff "lsof -i tcp:3000 | awk 'NR!=1 {print \$2}' | xargs kill ^M"
stuff "cd ~/Handshake/handshake; ^M"
stuff "bundle install; bundle exec rake db:migrate ^M"
stuff "set -a; . .env; set +a ^M"
stuff "env WEBPACK_ASSETS=true bin/conditional_pgbouncer bin/conditional_socksify bin/web ^M"

screen -t foreman
select 1
stuff "cd ~/Handshake/handshake; ^M"
sruff "foreman start"

screen -t webpack
select 2
stuff "lsof -i tcp:8080 |awk 'NR!=1 {print \$2}' | xargs kill ^M"
stuff "cd ~/Handshake/handshake; set -a; . .env; set +a; ^M"
stuff "env bin/webpack ^M"

screen -t guard
select 3
stuff "cd ~/Handshake/handshake; set -a; . .env; set +a; ^M"
stuff "bundle exec guard ^M"

screen -t local-test
select 4
stuff "cd ~/Handshake/handshake; nvm use; npm run local-test; ^M"

screen -t handshake-office
select 5
stuff "cd ~/Handshake/handshake-office; set -a; . .env; set +a; ^M"
stuff "foreman start ^M"

screen -t storybook
select 6
stuff "cd ~/Handshake/handshake; set -; . .env; set +a; ^M"
stuff "npm run storybook ^M"

screen -t rails-console
select 7
wrap off
stuff "cd ~/Handshake/handshake; ^M"
stuff "set -a; . .env; set +a ^M"
stuff "rails c ^M"

# start on the rails server
select 0

altscreen on
term screen-256color
bind ',' prev
bind '.' next
bind 'K' quit

# change the hardstatus settings to give an window list at the bottom of the
# screen, with the time and date and with the current window highlighted
hardstatus alwayslastline
hardstatus string '%{= kG}[ %{G}%H %{g}][%= %{= kw}%?%-Lw%?%{r}(%{W}%n*%f%t%?(%u)%?%{r})%{w}%?%+Lw%?%?%= %{g}][%{B} %m-%d %{W}%c %{g}]'
